"use strict";if("undefined"==typeof _)throw new Error("Please include Lodash (https://github.com/lodash/lodash)");if("undefined"==typeof XLSX)throw new Error("Please include js-xlsx (https://github.com/SheetJS/js-xlsx)");window.JSFile={},window.JSFile=window.JSFile||{},function(a){var b=function(){var a=this,b={sheet:{columns:[],data:[],headers:[],name:[]},headers:{colspan:["cols"],rowspan:["rows"],value:["display_name","name","label"]},columns:{type:[]}};this.transformData=function(a){return _.isArray(a)||(a=[a]),_.forEach(a,function(b,e){a[e]=c(b,e),_.isArray(b.headers[0])||(a[e].headers=[b.headers]),_.forEach(a[e].headers,function(b,c){_.forEach(b,function(b,f){a[e].headers[c][f]=d(b)})})}),a},this.nextLetter=function(a,b){return _.isUndefined(b)&&(b=1),a.replace(/([a-zA-Z])[^a-zA-Z]*$/,function(a){var c=a.charCodeAt(0);switch(c){case 90:return"A";case 122:return"a";default:return String.fromCharCode(c+b)}})},this.letterToNumber=function(a){return a===a.toLowerCase()?a.charCodeAt(0)-96:a.charCodeAt(0)-64},this.numberToLetter=function(a,b){return String.fromCharCode(b?a+64:a+96)},this.transformWorksheetHeadersArray=function(a){return _.forEach(a,function(b,c){_.forEach(b,function(b,d){if(b.rowspan>1)for(var e=1;e<b.rowspan;e++){var f=c+e;if(!_.has(a,f)){a[f]=[];for(var g=0;d>g;g++)a[f].push({})}a[f].splice(d,0,{})}if(b.colspan>1)for(var h=1;h<b.colspan;h++){var i=d+h;a[c].splice(i,0,{})}})}),a},this.convertWorksheetHeadersArrayToObject=function(b){var c={};return _.forEach(b,function(b,d){var e="A";_.forEach(b,function(b){_.has(b,"value")&&(c[e+(d+1)]=b.value),e=a.nextLetter(e)})}),c},this.calculateWorksheetHeadersMerges=function(a){var b=[];return _.forEach(a,function(a,c){_.forEach(a,function(a,d){(_.has(a,"rowspan")&&a.rowspan>1||_.has(a,"colspan")&&a.colspan>1)&&b.push({s:{c:d,r:c},e:{c:d+(a.colspan-1),r:c+(a.rowspan-1)}})})}),b};var c=function(a,c){var d=_.keys(a);return(!_.has(a,"columns")||_.isUndefined(a.columns))&&(a.columns=e(a,d,b.sheet.columns,[])),(!_.has(a,"data")||_.isUndefined(a.data))&&(a.data=e(a,d,b.sheet.data,[])),(!_.has(a,"headers")||_.isUndefined(a.headers))&&(a.headers=e(a,d,b.sheet.headers,[])),(!_.has(a,"name")||_.isUndefined(a.name))&&(a.name=e(a,d,b.sheet.name,"sheet"+(c+1))),{columns:a.columns,data:a.data,headers:a.headers,name:a.name}},d=function(a){var c={},d=[];return _.forEach(a,function(a,b){if(!_.isObject(a)){var b=_.snakeCase(b);c[b]=a,d.push(b)}}),_.has(c,"value")||(c.value=e(c,d,b.headers.value)),_.has(c,"rowspan")||(c.rowspan=parseInt(e(c,d,b.headers.rowspan,1))),_.has(c,"colspan")||(c.colspan=parseInt(e(c,d,b.headers.colspan,1))),{value:c.value,rowspan:c.rowspan,colspan:c.colspan}},e=function(a,b,c,d){var e=_.isUndefined(d)?"":d;return _.forEach(c,function(c){return _.includes(b,c)?(e=a[c],!1):void 0}),e}};a.FileUtil=new b}(window.JSFile),window.JSFile=window.JSFile||{},function(a){a.Workbook=function(b){var c="data param is required for Workbook model";if(_.isUndefined(b)||_.isNull(b))throw new Error(c);var d=this;this.SheetNames=[],this.Sheets={},b=a.FileUtil.transformData(b),_.forEach(b,function(b){d.SheetNames.push(b.name),d.Sheets[b.name]=new a.Worksheet(b)})}}(window.JSFile),window.JSFile=window.JSFile||{},function(a){a.Worksheet=function(b){var c="data param is required for Worksheet model";if(_.isUndefined(b)||_.isNull(b))throw new Error(c);var d=this;this["!merges"]=[],this["!ref"]=[];var e=a.FileUtil.transformWorksheetHeadersArray(b.headers),f=[];_.forEach(e,function(a){f.push(a.length)}),this["!merges"]=a.FileUtil.calculateWorksheetHeadersMerges(e);var g=e.length+1;e=a.FileUtil.convertWorksheetHeadersArrayToObject(e),_.forEach(e,function(b,c){d[c]=new a.WorksheetCell({type:"s",value:b})}),_.forEach(b.data,function(b){var c="A",e=0;_.forEach(b,function(b){d[c+g]=new a.WorksheetCell({type:"s",value:b.value}),c=a.FileUtil.nextLetter(c),e++}),f.push(e),g++});var h=_.max(f);this["!ref"]=XLSX.utils.encode_range({s:{c:0,r:0},e:{c:h-1,r:g-2}})}}(window.JSFile),window.JSFile=window.JSFile||{},function(a){a.WorksheetCell=function(a){var b="data param is required for WorksheetCell model",c="data.value param is required for WorksheetCell model";if(_.isUndefined(a)||_.isNull(a))throw new Error(b);if(!_.has(a,"value"))throw new Error(c);this.t=_.has(a,"type")?a.type:"s",this.v=a.value}}(window.JSFile),window.JSFile=window.JSFile||{},function(a){var b=function(){function b(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!=a.length;++d)c[d]=255&a.charCodeAt(d);return b}this.MESSAGE_WORKBOOK_IS_REQUIRED="workbook param is required for FileDownloader.downloadWorkbook",this.MESSAGE_WORKBOOK_MODEL_IS_INVALID="workbook param my be an instance of JSFile.Workbook",this.downloadWorkbook=function(d,e){if(_.isUndefined(d)||_.isNull(d))throw new Error(this.MESSAGE_WORKBOOK_IS_REQUIRED);if(!(d instanceof a.Workbook))throw new Error(this.MESSAGE_WORKBOOK_MODEL_IS_INVALID);_.isUndefined(e)&&(e="download.xlsx"),_.endsWith(e,".xlsx")||(e+=".xlsx");var f=XLSX.write(d,{bookType:"xlsx",bookSST:!1,type:"binary"}),g=b(f);c(e,g)};var c=function(a,b){var c,d=document,e=d.createElement("a"),f="application/octet-stream;charset=utf-8";if(navigator.msSaveBlob)return navigator.msSaveBlob(new Blob(["\ufeff",b],{type:f}),a);if("download"in e){var g=new Blob([b],{type:f});c=URL.createObjectURL(g),e.setAttribute("download",a)}else c="data:"+f+","+encodeURIComponent(b),e.setAttribute("target","_blank");e.href=c,e.setAttribute("style","display:none;"),d.body.appendChild(e),setTimeout(function(){if(e.click)e.click();else if(document.createEvent){var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0),e.dispatchEvent(a)}d.body.removeChild(e)},100)}};a.FileDownloader=new b}(window.JSFile),window.JSFile=window.JSFile||{},function(a){var b=function(){var a="FileReader: ";this.MESSAGE_FILE_DATA_IS_REQUIRED=a+"file_data param is required",this.MESSAGE_FILE_TYPE_IS_REQUIRED=a+"file_type param is required",this.MESSAGE_UNSUPPORTED_FILE_TYPE=a+"file type is not supported",this.MESSAGE_FILE_READ_ERROR=a+"could not read file. Either file data is invalid, or file_type does not match file_data.";var b={"text/plain":"txt","text/csv":"csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.ms-excel":"xls","application/vnd.oasis.opendocument.spreadsheet":"ods"};this.getFileType=function(a){if(!_.contains(_.keys(b),a))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_TYPE);return b[a]},this.getWorksheetNames=function(a,b){if(_.isUndefined(a)||_.isNull(a))throw new Error(this.MESSAGE_FILE_DATA_IS_REQUIRED);if(_.isUndefined(b)||_.isNull(b))throw new Error(this.MESSAGE_FILE_TYPE_IS_REQUIRED);if(b=b.toLowerCase(),!_.includes(_.keys(this.get_worksheet_names_handlers),b))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_TYPE);return this.get_worksheet_names_handlers[b](a)},this.fileToArray=function(a,b,c,d){if(_.isUndefined(a)||_.isNull(a))throw new Error(this.MESSAGE_FILE_DATA_IS_REQUIRED);if(_.isUndefined(b)||_.isNull(b))throw new Error(this.MESSAGE_FILE_TYPE_IS_REQUIRED);if(d=_.isUndefined(d)?"row":d.toLowerCase(),b=b.toLowerCase(),!_.includes(_.keys(this.file_to_array_handlers),b))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_TYPE);return this.file_to_array_handlers[b](a,c,d)};var c=function(a,b){var c=a.split(/\n/);_.forEach(c,function(a,b,c){c[b]=a.split(/,/)});var d;if(d=_.isArray(b)?_.isUndefined(b[0])||b[0]!==!0?!1:!0:b===!0?!0:!1){var e=[],f=c[0];return _.forEach(c,function(a){var b={};_.forEach(a,function(a,c){b[f[c]]=a}),e.push(b)}),[{name:"Sheet1",headings:e.shift(),data:e}]}return[{name:"Sheet1",headings:[],data:c}]},d=function(a,b,c){var d=[];try{var e=XLSX.read(a,{type:"binary"});d=f(e,b,c)}catch(g){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return d},e=function(a,b,c){var d=[];try{var e=XLS.read(a,{type:"binary"});d=f(e,b,c)}catch(g){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return d},f=function(a,b){var c=[],d=0;return _.forEach(a.Sheets,function(a,e){var f;f=_.isArray(b)?_.isUndefined(b[d])||b[d]!==!0?!1:!0:b===!0?!0:!1;var g=[],h={},i=f?{}:[],j=0;_.forEach(a,function(a,b){if(!_.isUndefined(a.v)){var c=b.match(/([A-Za-z]+)([0-9]+)/),d=c[1],e=parseInt(c[2]);f&&1===e&&(h[d]=a.v),(!f||e>1)&&(e>j&&(i=f?{}:[],g.push(i)),f?i[h[d]]=a.v:i.push(a.v)),j=e}}),c.push({name:e,headings:h,data:g}),d++}),c},g=function(a){var b=[];try{var c=XLSX.read(a,{type:"binary"});_.forEach(c.Sheets,function(a,c){b.push(c)})}catch(d){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return b},h=function(a){var b=[];try{var c=XLS.read(a,{type:"binary"});_.forEach(c.Sheets,function(a,c){b.push(c)})}catch(d){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return b};this.file_to_array_handlers={xlsx:d,ods:d,xls:e,txt:c,csv:c},this.get_worksheet_names_handlers={xlsx:g,ods:g,xls:h}};a.FileReader=new b}(window.JSFile);
//# sourceMappingURL=js-file.min.js.map