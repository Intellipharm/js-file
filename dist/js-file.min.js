window.Modernizr=function(a,b,c){function d(a){n.cssText=a}function e(a,b){return typeof a===b}var f,g,h,i="2.8.3",j={},k=b.documentElement,l="modernizr",m=b.createElement(l),n=m.style,o=({}.toString,{}),p=[],q=p.slice,r={}.hasOwnProperty;h=e(r,"undefined")||e(r.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return r.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=q.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(q.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(q.call(arguments)))};return d});for(var s in o)h(o,s)&&(g=s.toLowerCase(),j[g]=o[s](),p.push((j[g]?"":"no-")+g));return j.addTest=function(a,b){if("object"==typeof a)for(var d in a)h(a,d)&&j.addTest(d,a[d]);else{if(a=a.toLowerCase(),j[a]!==c)return j;b="function"==typeof b?b():b,"undefined"!=typeof enableClasses&&enableClasses&&(k.className+=" "+(b?"":"no-")+a),j[a]=b}return j},d(""),m=f=null,j._version=i,j}(this,this.document),Modernizr.addTest("adownload","download"in document.createElement("a")),Modernizr.addTest("filereader",function(){return!!(window.File&&window.FileList&&window.FileReader)}),function(){"use strict";window.JSFile=window.JSFile||{}}(),window.JSFile=window.JSFile||{},function(a){"use strict";
// supported file types
a.supported_file_types={txt:"text/plain",csv:"text/csv",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xls:"application/vnd.ms-excel",ods:"application/vnd.oasis.opendocument.spreadsheet"}}(window.JSFile),window.JSFile=window.JSFile||{},function(a){"use strict";/**
     * FileUtil Class
     *
     * @constructor
     */
var b=function(){var b=this,c="FileUtil: ";this.MESSAGE_UNSUPPORTED_FILE_MIMETYPE=c+"file mimetype is not supported",this.MESSAGE_UNSUPPORTED_FILE_EXTENSION=c+"file extension is not supported",this.MESSAGE_FILE_NAME_IS_REQUIRED=c+"file_name is required",this.MESSAGE_FILE_EXTENSION_MISMATCH=c+"the extension contained in the file_name argument does not match the file_extension argument",this.MESSAGE_FILE_EXTENSION_IS_REQUIRED=c+"an file extension must be provided, either as part of the filename or as the file_extension argument";
// data alternatives (these will be used as replacements for missing data)
var d={sheet:{columns:[],data:[],headers:[],name:[]},headers:{colspan:["cols"],rowspan:["rows"],value:["display_name","name","label"]},columns:{type:[]}};
///////////////////////////////////////////////////////////
//
// public methods
//
///////////////////////////////////////////////////////////
/**
         * transformData
         *
         * @param data
         */
this.transformData=function(a){
// convert root to indexed array
// loop sheets
return _.isArray(a)||(a=[a]),_.forEach(a,function(b,c){
// transform sheet
a[c]=e(b,c),
// headers should contain array of rows
_.isArray(b.headers[0])||(a[c].headers=[b.headers]),
// headers
_.forEach(a[c].headers,function(b,d){
// columns
_.forEach(b,function(b,e){
// transform
a[c].headers[d][e]=f(b)})})}),a},/**
         * transformFilenameAndExtension
         *
         * @param filename
         * @param file_extension
         * @returns {*}
         */
this.transformFilenameAndExtension=function(b,c){if(_.isUndefined(b)||_.isNull(b)||""===b)throw new Error(this.MESSAGE_FILE_NAME_IS_REQUIRED);if(!_.isUndefined(c)&&!_.includes(_.keys(a.supported_file_types),c))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_EXTENSION);
// search filename for extension
var d=/[^.]+$/.exec(b);
// if possible filename extension matches supported extensions, then extract
if(_.includes(_.keys(a.supported_file_types),d[0])){
// extension found in file_name does not match file_extension
if(!_.isUndefined(c)&&d[0]!==c)throw new Error(this.MESSAGE_FILE_EXTENSION_MISMATCH);
// remove extension from filename
b=/(.*)\.[^.]+$/.exec(b)[1],
// set file_extension
c=d[0]}else if(_.isUndefined(c))throw new Error(this.MESSAGE_FILE_EXTENSION_IS_REQUIRED);
// add extension to filename
return b+="."+c,{filename:b,file_extension:c}},/**
         * nextLetter
         *
         * @param letter
         * @param increment
         * @returns {*}
         */
this.nextLetter=function(a,b){return _.isUndefined(b)&&(b=1),a.replace(/([a-zA-Z])[^a-zA-Z]*$/,function(a){var c=a.charCodeAt(0);switch(c){case 90:return"A";case 122:return"a";default:return String.fromCharCode(c+b)}})},/**
         * letterToNumber
         *
         * @param letter
         * @returns {number}
         */
this.letterToNumber=function(a){return a===a.toLowerCase()?a.charCodeAt(0)-96:a.charCodeAt(0)-64},/**
         * numberToLetter
         *
         * @param number
         * @param uppercase
         * @returns {letter}
         */
this.numberToLetter=function(a,b){return b?String.fromCharCode(a+64):String.fromCharCode(a+96)},/**
         * transformWorksheetHeadersArray
         * inserts blank items based on rowspans & colspans
         *
         * @param headers
         * @returns {Array}
         */
this.transformWorksheetHeadersArray=function(a){var b=_.cloneDeep(a);return _.forEach(a,function(a,c){var d=0;_.forEach(a,function(a,e){
// add rows
if(a.rowspan>1)for(var f=1;f<a.rowspan;f++){var g=c+f;
// create next row if does not exist
if(!_.has(b,g)){b[g]=[];
// create next row columns
for(var h=0;h<e+d;h++)b[g].push({})}
// splice into next row
b[g].splice(e+d,0,{})}
// add columns
if(a.colspan>1){for(var i=1;i<a.colspan;i++){var j=e+d+i;
// splice into next column
b[c].splice(j,0,{})}d+=a.colspan-1}})}),b},/**
         * convertWorksheetHeadersArrayToObject
         *
         * @param headers
         * @returns {{}}
         */
this.convertWorksheetHeadersArrayToObject=function(a){var c={};return _.forEach(a,function(a,d){var e="A";_.forEach(a,function(a){
// add value (if exists)
_.has(a,"value")&&(c[e+(d+1)]=a.value),
// increment letter
e=b.nextLetter(e)})}),c},/**
         * calculateWorksheetHeadersMerges
         *
         * @param headers
         * @returns {Array}
         */
this.calculateWorksheetHeadersMerges=function(a){var b=[];return _.forEach(a,function(a,c){_.forEach(a,function(a,d){
// if has rowspan or colspan greater than 1
(_.has(a,"rowspan")&&a.rowspan>1||_.has(a,"colspan")&&a.colspan>1)&&b.push({s:{c:d,r:c},// start
e:{c:d+(a.colspan-1),r:c+(a.rowspan-1)}})})}),b},/**
         * getFileExtension
         *
         * @param mimetype
         * @returns {*}
         */
this.getFileExtension=function(b){if(!_.includes(_.values(a.supported_file_types),b))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_MIMETYPE);return _.findKey(a.supported_file_types,function(a){return a===b})},/**
         * getFileMimeType
         *
         * @param file_extension
         * @returns {*}
         */
this.getFileMimeType=function(b){if(!_.includes(_.keys(a.supported_file_types),b))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_EXTENSION);return a.supported_file_types[b]};
///////////////////////////////////////////////////////////
//
// private methods
//
///////////////////////////////////////////////////////////
/**
         * transformSheet
         *
         * @param data
         * @param index
         */
var e=function(a,b){
// get keys
var c=_.keys(a);
// name
// data
// headers
// name
return _.has(a,"columns")&&!_.isUndefined(a.columns)||(a.columns=g(a,c,d.sheet.columns,[])),_.has(a,"data")&&!_.isUndefined(a.data)||(a.data=g(a,c,d.sheet.data,[])),_.has(a,"headers")&&!_.isUndefined(a.headers)||(a.headers=g(a,c,d.sheet.headers,[])),_.has(a,"name")&&!_.isUndefined(a.name)||(a.name=g(a,c,d.sheet.name,"sheet"+(b+1))),{columns:a.columns,data:a.data,headers:a.headers,name:a.name}},f=function(a){var b={},c=[];
// loop fields
// value
// rowspan
// colspan
return _.forEach(a,function(a,d){
// convert item keys & values to snake case
if(!_.isObject(a)){var e=_.snakeCase(d);b[e]=a,c.push(e)}}),_.has(b,"value")||(b.value=g(b,c,d.headers.value)),_.has(b,"rowspan")||(b.rowspan=parseInt(g(b,c,d.headers.rowspan,1))),_.has(b,"colspan")||(b.colspan=parseInt(g(b,c,d.headers.colspan,1))),{value:b.value,rowspan:b.rowspan,colspan:b.colspan}},g=function(a,b,c,d){var e=_.isUndefined(d)?"":d;return _.forEach(c,function(c){if(_.includes(b,c))return e=a[c],!1}),e}};
// create singleton
a.FileUtil=new b}(window.JSFile),window.JSFile=window.JSFile||{},function(a){"use strict";/**
     * Workbook Model
     *
     * @param data
     * @constructor
     */
a.Workbook=function(b){var c="data param is required for Workbook model";if(_.isUndefined(b)||_.isNull(b))throw new Error(c);var d=this;this.SheetNames=[],this.Sheets={},
// transform data
b=a.FileUtil.transformData(b),
// sheets
_.forEach(b,function(b){d.SheetNames.push(b.name),d.Sheets[b.name]=new a.Worksheet(b)})}}(window.JSFile),window.JSFile=window.JSFile||{},function(a){"use strict";/**
     * Worksheet Model
     *
     * @param data
     * @constructor
     */
a.Worksheet=function(b){var c="data param is required for Worksheet model";if(_.isUndefined(b)||_.isNull(b))throw new Error(c);var d=this;this["!merges"]=[],this["!ref"]=[];
// transform headers array
var e=a.FileUtil.transformWorksheetHeadersArray(b.headers),f=[];_.forEach(e,function(a){f.push(a.length)}),
// calculate worksheet merges
this["!merges"]=a.FileUtil.calculateWorksheetHeadersMerges(e);
// set body row starting point
var g=e.length+1;
// convert header array to object
e=a.FileUtil.convertWorksheetHeadersArrayToObject(e),
// set worksheet header data
_.forEach(e,function(b,c){
// TODO: add column type support (new module.WorksheetCell({type: "s"})
d[c]=new a.WorksheetCell({type:"s",value:b})}),
// set worksheet body data
_.forEach(b.data,function(b){var c="A",e=0;_.forEach(b,function(b){
// add data
d[c+g]=new a.WorksheetCell({type:"s",value:b.value}),
// increment letter
c=a.FileUtil.nextLetter(c),
// count letters
e++}),f.push(e),
// increment cell number
g++});
// get highest letter
var h=_.max(f);
// set worksheet range
this["!ref"]=XLSX.utils.encode_range({s:{c:0,r:0},// start
e:{c:h-1,r:g-2}})}}(window.JSFile),window.JSFile=window.JSFile||{},function(a){"use strict";/**
     * WorksheetCell Model
     *
     * @param data
     * @constructor
     */
a.WorksheetCell=function(a){var b="data param is required for WorksheetCell model",c="data.value param is required for WorksheetCell model";if(_.isUndefined(a)||_.isNull(a))throw new Error(b);if(!_.has(a,"value"))throw new Error(c);this.t=_.has(a,"type")?a.type:"s",this.v="",null!==a.value&&(this.v=a.value)}}(window.JSFile),function(){"use strict";
// dependency checks
if("undefined"==typeof window._)throw new Error("Please include Lodash (https://github.com/lodash/lodash)");if("undefined"==typeof window.XLSX)throw new Error("Please include js-xlsx (https://github.com/SheetJS/js-xlsx)");if("undefined"==typeof window.Blob)throw new Error("Please include blob (https://github.com/eligrey/Blob.js/)")}(),window.JSFile=window.JSFile||{},function(a){"use strict";/**
     * FileDownloader Class
     *
     * @constructor
     */
var b=function(){var b=this,c="FileDownloader: ";this.MESSAGE_WORKBOOK_IS_REQUIRED=c+"workbook param is required for FileDownloader.downloadWorkbook",this.MESSAGE_WORKBOOK_MODEL_IS_INVALID=c+"workbook param must be an instance of JSFile.Workbook",this.MESSAGE_FILE_NAME_IS_REQUIRED=c+"file_name is required",this.CURRENTLY_UNSUPPORTED_FILE_TYPE=c+"this file type is currently not supported.",this.UNSUPPORTED_BROWSER_FEATURE_AND_NO_FALLBACK=c+"browser does support the required feature and no fallback method was provided",
///////////////////////////////////////////////////////////
//
// public methods
//
///////////////////////////////////////////////////////////
/**
         * downloadWorkbook
         *
         * @param workbook
         * @param filename
         * @param file_extension
         */
this.downloadWorkbook=function(b,c,d){
// validate args
if(_.isUndefined(b)||_.isNull(b))throw new Error(this.MESSAGE_WORKBOOK_IS_REQUIRED);if(!(b instanceof a.Workbook))throw new Error(this.MESSAGE_WORKBOOK_MODEL_IS_INVALID);if(_.isUndefined(c)||_.isNull(c)||""===c)throw new Error(this.MESSAGE_FILE_NAME_IS_REQUIRED);
// transform file data (name & extension)
var e=a.FileUtil.transformFilenameAndExtension(c,d),f=this.create_file_handlers[e.file_extension](b,e.file_extension),g=a.FileUtil.getFileMimeType(e.file_extension);
// initiate download
j(f,e.filename,g)};
///////////////////////////////////////////////////////////
//
// private methods
//
///////////////////////////////////////////////////////////
/**
         * convertStringToArrayBuffer
         *
         * @param str
         * @returns {ArrayBuffer}
         */
var d=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!==a.length;++d)c[d]=255&a.charCodeAt(d);return b},e=function(a,b){return XLSX.write(a,{bookType:b,bookSST:!1,type:"binary"})},f=function(){throw new Error(this.CURRENTLY_UNSUPPORTED_FILE_TYPE)},g=function(){throw new Error(this.CURRENTLY_UNSUPPORTED_FILE_TYPE)},h=function(){throw new Error(this.CURRENTLY_UNSUPPORTED_FILE_TYPE)},i=function(){throw new Error(this.CURRENTLY_UNSUPPORTED_FILE_TYPE)},j=function(a,c,e){var f=d(a),g=new Blob([f],{type:e});
// Blob is natively supported by all but ie8 & ie9
// Blob.js creates a shim for ie8 & ie9
// TODO: add seperate handling for text & csv
// if browser is IE10+
if(window.navigator.msSaveBlob)
// initiate ie10 download
return window.navigator.msSaveBlob(g,c);
// adownload is not supported by browser (ie8, ie9, Safari)
if(!Modernizr.adownload||!window.saveAs){
// no initiateFileDownloadFallback method is defined
if(_.isUndefined(b.initiateFileDownloadFallback))throw new Error(b.UNSUPPORTED_BROWSER_FEATURE_AND_NO_FALLBACK);
// call initiate download fallback
return b.initiateFileDownloadFallback(g,c,a)}
// initiate download
return window.saveAs(g,c)};
///////////////////////////////////////////////////////////
//
// init
//
///////////////////////////////////////////////////////////
// handlers mapped by file type
this.create_file_handlers={xlsx:e,ods:f,xls:g,txt:h,csv:i}};a.FileDownloader=new b}(window.JSFile),function(){"use strict";
// dependency checks
if("undefined"==typeof window._)throw new Error("Please include Lodash (https://github.com/lodash/lodash)");if("undefined"==typeof window.XLSX)throw new Error("Please include js-xlsx (https://github.com/SheetJS/js-xlsx)")}(),window.JSFile=window.JSFile||{},function(a){"use strict";/**
     * FileReader Class
     *
     * @constructor
     */
var b=function(){var a="FileReader: ";this.MESSAGE_FILE_DATA_IS_REQUIRED=a+"file_data param is required",this.MESSAGE_FILE_TYPE_IS_REQUIRED=a+"file_type param is required",this.MESSAGE_UNSUPPORTED_FILE_TYPE=a+"file type is not supported",this.MESSAGE_FILE_READ_ERROR=a+"could not read file. Either file data is invalid, or file_type does not match file_data.",
///////////////////////////////////////////////////////////
//
// public methods
//
///////////////////////////////////////////////////////////
/**
         * getWorksheetNames
         *
         * @param file_data
         * @param file_type
         * @returns {*}
         */
this.getWorksheetNames=function(a,b){
// validate args
if(_.isUndefined(a)||_.isNull(a))throw new Error(this.MESSAGE_FILE_DATA_IS_REQUIRED);if(_.isUndefined(b)||_.isNull(b))throw new Error(this.MESSAGE_FILE_TYPE_IS_REQUIRED);if(b=b.toLowerCase(),!_.includes(_.keys(this.get_worksheet_names_handlers),b))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_TYPE);return this.get_worksheet_names_handlers[b](a)},/**
         * fileToArray
         *
         * @param file_data
         * @param file_type
         * @param array|boolean worksheet_has_headings
         * @param group_by TODO: add support for this (group by row: [0: {A:a1, B:b1}] or group by column: {A: [0:a1, 1:a2]}
         * @returns {*}
         */
this.fileToArray=function(a,b,c,d){
// validate args
if(_.isUndefined(a)||_.isNull(a))throw new Error(this.MESSAGE_FILE_DATA_IS_REQUIRED);if(_.isUndefined(b)||_.isNull(b))throw new Error(this.MESSAGE_FILE_TYPE_IS_REQUIRED);if(
// arg defaults
d=_.isUndefined(d)?"row":d.toLowerCase(),b=b.toLowerCase(),!_.includes(_.keys(this.file_to_array_handlers),b))throw new Error(this.MESSAGE_UNSUPPORTED_FILE_TYPE);return this.file_to_array_handlers[b](a,c,d)};
///////////////////////////////////////////////////////////
//
// private methods
//
///////////////////////////////////////////////////////////
/**
         * txtToArray
         *
         * @param data
         * @param array|boolean worksheet_has_headings
         * @param group_by
         * @returns {*|Array}
         */
var b=function(a,b){var c=a.split(/\n/);_.forEach(c,function(a,b,c){c[b]=a.split(/,/)});
// has got a heading row?
var d;if(d=_.isArray(b)?!_.isUndefined(b[0])&&b[0]===!0:b===!0){var e=[],f=c[0];return _.forEach(c,function(a){var b={};_.forEach(a,function(a,c){b[f[c]]=a}),e.push(b)}),[{name:"Sheet1",headings:e.shift(),data:e}]}return[{name:"Sheet1",headings:[],data:c}]},c=function(a,b,c){var d=[];try{var f=XLSX.read(a,{type:"binary"});d=e(f,b,c)}catch(a){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return d},d=function(a,b,c){
// dependency check
if("undefined"==typeof window.XLS)throw new Error("Please include js-xls (https://github.com/SheetJS/js-xls)");var d=[];try{var f=window.XLS.read(a,{type:"binary"});d=e(f,b,c)}catch(a){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return d},e=function(a,b){var c=[],d=0;
// loop worksheets
return _.forEach(a.Sheets,function(a,e){
// has worksheet got headings?
var f;f=_.isArray(b)?!_.isUndefined(b[d])&&b[d]===!0:b===!0;var g=[],h={},i=f?{}:[],j=0;
// loop worksheet properties
_.forEach(a,function(a,b){
// skip items that do not have a value property
if(!_.isUndefined(a.v)){
// get column name & row number
var c=b.match(/([A-Za-z]+)([0-9]+)/),d=c[1],e=parseInt(c[2]);
// get headings
f&&1===e&&(h[d]=a.v),
// get rows
(!f||e>1)&&(
// if new row
e>j&&(i=f?{}:[],g.push(i)),
// add to row
f?i[h[d]]=a.v:i.push(a.v)),j=e}}),c.push({name:e,headings:h,data:g}),d++}),c},f=function(a){var b=[];try{var c=XLSX.read(a,{type:"binary"});
// loop worksheets
_.forEach(c.Sheets,function(a,c){b.push(c)})}catch(a){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return b},g=function(a){var b=[];try{var c=XLS.read(a,{type:"binary"});
// loop worksheets
_.forEach(c.Sheets,function(a,c){b.push(c)})}catch(a){throw new Error(this.MESSAGE_FILE_READ_ERROR)}return b};
///////////////////////////////////////////////////////////
//
// init
//
///////////////////////////////////////////////////////////
// handlers mapped by file type
this.file_to_array_handlers={xlsx:c,ods:c,xls:d,txt:b,csv:b},this.get_worksheet_names_handlers={xlsx:f,ods:f,xls:g}};a.FileReader=new b}(window.JSFile);
//# sourceMappingURL=js-file.min.js.map